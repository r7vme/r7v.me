---
draft: true
title: Ubuntu splits all after 127.0.0.1 in dns-nameservers flag
author: rsokolkov
type: post
date: 2013-02-05T09:50:00+00:00
url: /ubuntu-splits-all-after-127001-in-dns/
blogger_bid:
  - 6610086545674237724
blogger_blog:
  - romans-it.blogspot.com
blogger_id:
  - 6105900455612781439
blogger_author:
  - 14718283222819047051
blogger_permalink:
  - /2013/02/ubuntu-splits-all-after-127001-in-dns.html
categories:
  - Uncategorized
tags:
  - interfaces
  - nameserver
  - resolvconf
  - ubuntu

---
<div dir="ltr" style="text-align: left;" trbidi="on">
  Ubuntu manages local DNS settings by &#8220;resolvconf&#8221; package and settings could be set in /etc/network/interfaces file.</p> 
  
  <p>
    For example
  </p>
  
  <blockquote class="tr_bq" style="text-align: left;">
    <p>
      # This file describes the network interfaces available on your system<br /># and how to activate them. For more information, see interfaces(5).
    </p>
    
    <p>
      # The loopback network interface<br />auto lo<br />&nbsp; iface lo inet loopback
    </p>
    
    <p>
      # The primary network interface<br />auto eth0<br />iface eth0 inet static<br />&nbsp; address 192.168.122.20<br />&nbsp; netmask 255.255.255.0<br />&nbsp; gateway 192.168.122.1<br />&nbsp; dns-nameservers 127.0.0.1 8.8.8.8 <br />&nbsp; dns-search local.lan cloud.lan
    </p>
  </blockquote>
  
  <p>
    In detail &#8220;man interfaces&#8221; or &#8220;man resolvconf&#8221;.
  </p>
  
  <p>
    I have local dns server on 127.0.0.1. And i&#8217;ve plunged in strange behavior with &#8220;dns-nameservers&#8221; flag.
  </p>
  
  <p>
    If i set
  </p>
  
  <blockquote class="tr_bq">
    <div style="text-align: left;">
      dns-nameservers 8.8.8.8 127.0.0.1
    </div>
  </blockquote>
  
  <p>
    It works like a charm.
  </p>
  
  <blockquote class="tr_bq">
    <p>
      cat /etc/resolv.conf
    </p>
  </blockquote>
  
  <blockquote class="tr_bq">
    <p>
      # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)<br />#&nbsp;&nbsp;&nbsp;&nbsp; DO NOT EDIT THIS FILE BY HAND &#8212; YOUR CHANGES WILL BE OVERWRITTEN<br />nameserver 8.8.8.8<br />nameserver 127.0.0.1<br />search local.lan cloud.lan
    </p>
  </blockquote>
  
  <p>
    But if I put 127.0.0.1 as first nameserver
  </p>
  
  <blockquote class="tr_bq">
    <p>
      dns-nameservers 127.0.0.1 8.8.8.8
    </p>
  </blockquote>
  
  <p>
    There is no nameservers after 127.0.0.1 &#8230;
  </p>
  
  <blockquote class="tr_bq">
    <p>
      cat /etc/resolv.conf&nbsp;
    </p>
  </blockquote>
  
  <blockquote class="tr_bq">
    <p>
      # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)<br />#&nbsp;&nbsp;&nbsp;&nbsp; DO NOT EDIT THIS FILE BY HAND &#8212; YOUR CHANGES WILL BE OVERWRITTEN<br />nameserver 127.0.0.1<br />search local.lan cloud.lan
    </p>
  </blockquote>
  
  <p>
    But I want to be able to use local dns as preferable plus other public nameserver.
  </p>
  
  <p>
    What i&#8217;ve found here /etc/resolvconf/update.d/libc (this file related to resolvconf package)
  </p>
  
  <blockquote class="tr_bq">
    <p>
      &#8230;<br /> # Set TRUNCATE_NAMESERVER_LIST_AFTER_LOOPBACK_ADDRESS=no<br /># to allow additional nameserver addresses to be listed in<br /># resolv.conf after an initial loopback address 127.* or ::1.<br /> &#8230;
    </p>
  </blockquote>
  
  <p>
    <b>SOLUTION:</b>
  </p>
  
  <blockquote class="tr_bq">
    <p>
      echo &#8220;TRUNCATE_NAMESERVER_LIST_AFTER_LOOPBACK_ADDRESS=no&#8221; >> /etc/default/resolvconf
    </p>
  </blockquote>
  
  <p>
    Used ubuntu 12.04 LTS
  </p>
  
  <p>
    </div>
